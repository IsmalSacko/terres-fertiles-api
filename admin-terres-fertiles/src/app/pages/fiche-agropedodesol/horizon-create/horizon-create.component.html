<div class="container form-container py-3">

    <form (ngSubmit)="createHorizon()" #ficheForm="ngForm" class="mat-elevation-z2"
        style="max-width:600px;margin:auto;">
        <h2>Créer un horizon</h2>
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Fiche associée</mat-label>
            <mat-select required name="fiche" [(ngModel)]="horizon.fiche">
                <mat-option *ngFor="let fiche of fiches" [value]="fiche.id">{{ fiche.EAP || fiche.nom_sondage
                    }}</mat-option>
            </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Nom de l'horizon</mat-label>
            <mat-select [(ngModel)]="horizon.nom" name="nom" required="">
                <mat-option *ngFor="let n of nomsDisponibles" [value]="n">{{n}}</mat-option>
            </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Profondeur</mat-label>
            <input matInput name="profondeur" [(ngModel)]="horizon.profondeur">
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Texture</mat-label>
            <input matInput name="texture" [(ngModel)]="horizon.texture">
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Humidité</mat-label>
            <mat-select name="humidite" [(ngModel)]="horizon.humidite" required>
                <mat-option *ngFor="let h of humiditeDispo" [value]="h">{{h}}</mat-option>
            </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Couleur</mat-label>
            <input matInput name="couleur" [(ngModel)]="horizon.couleur">
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Hydromorphie</mat-label>
            <mat-select name="hydromorphie" [(ngModel)]="horizon.hydromorphie">
                <mat-option *ngFor="let hy of hydromorphieDispo" [value]="hy">{{hy}}</mat-option>
            </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Test HCl</mat-label>
            <mat-select name="test_hcl" [(ngModel)]="horizon.test_hcl">
                <mat-option *ngFor="let htc of htcDispo" [value]="htc">{{htc}}</mat-option>
            </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Porosité</mat-label>
            <mat-select matInput name="porosite" [(ngModel)]="horizon.porosite">
                <mat-option *ngFor="let p of porositeDispo" [value]="p">{{p}}</mat-option>
            </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Compacité</mat-label>
            <mat-select name="compacite" [(ngModel)]="horizon.compacite">
                <mat-option *ngFor="let c of compaciteDispo" [value]="c">{{c}}</mat-option>
            </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Activité biologique</mat-label>
            <input matInput name="activite_bio" [(ngModel)]="horizon.activite_bio">
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Commentaires</mat-label>
            <textarea matInput name="commentaires" [(ngModel)]="horizon.commentaires"></textarea>
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Représentation du profil</mat-label>
            <input matInput name="representation_profil" [(ngModel)]="horizon.representation_profil">
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Échantillon</mat-label>
            <input matInput name="echantillon" [(ngModel)]="horizon.echantillon">
        </mat-form-field>
        <!-- Ajout des photos si besoin -->
        <button mat-raised-button color="primary" type="submit"
            [disabled]="loading || !ficheForm.form.valid">SUIVANT</button>
        <button *ngIf="lastCreatedHorizonId" mat-stroked-button color="accent" type="button"
            (click)="goToAddPhotos(lastCreatedHorizonId)">Ajouter des photos au dernier horizon</button>
        <div *ngIf="loading">
            <mat-progress-bar mode="indeterminate"></mat-progress-bar>
        </div>
        <div *ngIf="success">
            <mat-icon color="primary">check_circle</mat-icon>
            <span style="margin-left:8px">Horizon créé (ID: {{ lastCreatedHorizonId }})</span>
        </div>
        <div *ngIf="error">
            <div class="error">{{ error }}</div>
        </div>
    </form>
</div>