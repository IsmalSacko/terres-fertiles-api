<h2>Modifier ou créer une intervention</h2>

<!-- Liste des interventions existantes pour cette cellule -->
<div *ngIf="existingItems && existingItems.length > 0" style="padding:10px;">
  <h4>Interventions existantes</h4>
  <div *ngFor="let it of existingItems" style="display:flex; align-items:flex-start; gap:8px; padding:6px; border-bottom:1px solid #eee;">
    <input type="checkbox" [checked]="selectedToDelete.has(it.id)" (change)="toggleSelect(it.id)" />
    <div style="flex:1">
      <strong>{{ it.titre || '(sans titre)' }}</strong><br>
      <small>Date: {{ it.date_debut }} • Responsable: {{ it.responsable || 'N/A' }} • Statut: {{ it.statut }}</small>
    </div>
    <div>
      <button type="button" (click)="editItem(it)">Éditer</button>
    </div>
  </div>
  <div style="margin-top:8px; text-align:right;">
    <button type="button" (click)="deleteSelected()" [disabled]="selectedToDelete.size === 0">Supprimer sélection</button>
  </div>
</div>

<form (ngSubmit)="onSave()" #form="ngForm" class="planning-table">

  <div class="plateforme-row" style="flex-direction: column; gap: 12px; padding: 10px;">
    <!-- Date début -->
    <div style="display: flex; align-items: center;">
      <div class="corner-cell" style="width: 160px;">Date début</div>
      <input
        type="date"
        [(ngModel)]="melange.date_debut"
        name="date_debut"
        required
        style="flex-grow: 1; height: 36px; padding: 0 8px; font-size: 14px;"
      />
    </div>

    <!-- Titre -->
    <div style="display: flex; align-items: center;">
      <div class="corner-cell" style="width: 160px;">Titre / Intervention</div>
      <input
        type="text"
        [(ngModel)]="melange.titre"
        name="titre"
        required
        style="flex-grow: 1; height: 36px; padding: 0 8px; font-size: 14px;"
      />
    </div>

    <!-- Durée -->
    <div style="display: flex; align-items: center;">
      <div class="corner-cell" style="width: 160px;">Durée (jours)</div>
      <input
        type="number"
        [(ngModel)]="melange.duree_jours"
        name="duree_jours"
        min="1"
        required
        style="flex-grow: 1; height: 36px; padding: 0 8px; font-size: 14px;"
      />
    </div>

    <!-- Statut -->
    <div style="display: flex; align-items: center;">
      <div class="corner-cell" style="width: 160px;">Statut</div>
      <select
        [(ngModel)]="melange.statut"
        name="statut"
        required
        style="flex-grow: 1; height: 36px; padding: 0 8px; font-size: 14px;"
      >
        <option value="planned">Planned</option>
        <option value="active">Active</option>
        <option value="done">Done</option>
      </select>
    </div>

    <!-- Mélange : nom readonly -->
    <div style="display: flex; align-items: center;">
      <div class="corner-cell" style="width: 160px;">Mélange (Nom)</div>
      <input
        type="text"
        [value]="melange.melange_nom"
        disabled
        style="flex-grow: 1; height: 36px; padding: 0 8px; font-size: 14px; background-color: #eee;"
      />
    </div>

    <!-- Mélange : id caché -->
    <input
      type="hidden"
      [(ngModel)]="melange.melange"
      name="melange"
      required
    />
  </div>

  <div class="actions" style="display:flex; justify-content:flex-end; margin-top: 20px; gap: 12px;">

    <button type="button" (click)="onCancel()">Annuler</button>

    <button type="submit" [disabled]="!form.form.valid">Enregistrer</button>
  </div>

</form>
