<div class="saisie-vente-container">
  <!-- En-tête de la page -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-title">
        <mat-icon class="header-icon">receipt_long</mat-icon>
        <div class="title-text">
          <h1>Fiches de Saisie de Vente</h1>
          <p>Gestion des ventes de produits et mélanges</p>
        </div>
      </div>
      <div class="header-actions">
        <button mat-raised-button color="primary" [routerLink]="['/saisies-vente/new']">
          <mat-icon>add</mat-icon>
          Nouvelle saisie
        </button>
      </div>
    </div>
  </div>

  <!-- État de chargement -->
  @if (loading) {
    <div class="loading-state">
      <mat-spinner class="loading-spinner"></mat-spinner>
      <p>Chargement des saisies de vente...</p>
    </div>
  }

  <!-- Message d'erreur -->
  @if (errorMsg) {
    <div class="error-state">
      <mat-icon>error</mat-icon>
      <p class="error-message">{{ errorMsg }}</p>
    </div>
  }

  <!-- État vide -->
  @if (!loading && !errorMsg && saisietes.length === 0) {
    <div class="empty-state">
      <mat-icon>inbox</mat-icon>
      <p>Aucune saisie de vente disponible</p>
    </div>
  }

  <!-- Grille des fiches de vente -->
  @if (!loading && !errorMsg && saisietes.length > 0) {
    <div class="ventes-grid">
      @for (s of saisietes; track s.id) {
        <div class="vente-card">
          <div class="vente-header">
            <div class="header-main">
              <div class="client-info-header">
                <mat-icon class="client-icon">person</mat-icon>
                <div class="client-details">
                  <h3 class="client-name">{{ s.nom_client }}</h3>
                  <span class="vente-id">
                    {{ s.produit ? (s.produit.melange.nom || s.produit.reference_produit) : 'Vente #' + s.id }}
                  </span>
                </div>
              </div>
              <div class="validation-status">
                @if (s.est_validee) {
                  <span class="validation-badge validated">
                    <mat-icon>verified</mat-icon>
                    <span>Validée</span>
                  </span>
                } @else {
                  <span class="validation-badge pending">
                    <mat-icon>pending</mat-icon>
                    <span>En attente</span>
                  </span>
                }
              </div>
              <!-- Les boutons d'action sont déplacés en bas de la carte -->
            </div>
          </div>
          <div class="vente-body">
            <div class="client-info">
              <div class="info-item">
                <div class="info-label">
                  <mat-icon>person</mat-icon>
                  Client
                </div>
                <div class="info-value">{{ s.nom_client }}</div>
              </div>
              <div class="info-item">
                <div class="info-label">
                  <mat-icon>scale</mat-icon>
                  Volume
                </div>
                <div class="info-value">{{ formatVolumeWithConversion(+s.volume_tonne) }}</div>
              </div>
              <div class="info-item">
                <div class="info-label">
                  <mat-icon>sell</mat-icon>
                  Date de vente
                </div>
                <div class="info-value">{{ s.date_vente | date:'dd/MM/yyyy' }}</div>
              </div>
              <div class="info-item">
                <div class="info-label">
                  <mat-icon>check_circle</mat-icon>
                  Statut
                </div>
                <div class="info-value">
                  {{ s.est_validee ? '✅ Validée' : '⏳ En attente' }}
                </div>
              </div>
            </div>
            <div class="action-buttons" style="margin-top: 18px; justify-content: flex-end;">
              <a [routerLink]="['/detail-saisie-vente', s.id]"
                 matTooltip="Voir la fiche"
                 class="action-badge view">
                <mat-icon>visibility</mat-icon>
                <span>Voir</span>
              </a>
              <a [routerLink]="['/saisies-vente/edit', s.id]"
                 matTooltip="Modifier cette saisie"
                 class="action-badge edit">
                <mat-icon>edit</mat-icon>
                <span>Modifier</span>
              </a>
        <button matTooltip="Supprimer cette saisie"
          class="action-badge delete"
          (click)="onDeleteSaisie(s)">
                <mat-icon>delete</mat-icon>
                <span>Supprimer</span>
              </button>
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>
